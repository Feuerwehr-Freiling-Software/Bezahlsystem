@using System.Timers;
@inject HttpClient http

<MudNavMenu>
    <MudNavLink Href="/" Match="NavLinkMatch.All">Index</MudNavLink>
    <MudNavLink Href="/products" Match="NavLinkMatch.Prefix">Produkte</MudNavLink>
    <AuthorizeView Roles="Admin">
        <Authorized>
            <MudNavGroup Title="Administration" Icon="@Icons.Filled.AdminPanelSettings" IconColor="Color.Primary">
                <MudNavGroup Title="Benutzerverwaltung" Icon="@Icons.Filled.People" IconColor="Color.Primary">
                    <MudNavLink Href="/user" Match="NavLinkMatch.Prefix" Icon="@Icons.Filled.ManageAccounts" IconColor="Color.Primary">Benutzer</MudNavLink>
                    <MudNavLink Href="/userstatistics" Match="NavLinkMatch.Prefix" Icon="@Icons.Filled.BarChart" IconColor="Color.Primary">Benutzerstatistiken</MudNavLink>
                </MudNavGroup>
                <MudNavLink Href="/articles" Match="NavLinkMatch.Prefix" Icon="@Icons.Filled.Brightness5" IconColor="Color.Primary">Artikelverwaltung</MudNavLink>
                <MudNavLink Href="/vendingMachine" Match="NavLinkMatch.Prefix" IconColor="Color.Primary" Icon="fa-solid fa-cash-register">Automatenverwaltung</MudNavLink>
                <MudNavLink Href="/accessToken" Match="NavLinkMatch.Prefix" Icon="@Icons.Filled.GeneratingTokens" IconColor="Color.Primary">Zugriffsverwaltung</MudNavLink>
                <MudNavLink Href="/errors" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.ErrorOutline" IconColor="Color.Primary">ErrorCodes</MudNavLink>
                <MudNavLink Href="/logs" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Description" IconColor="Color.Primary">Logs</MudNavLink>
            </MudNavGroup>
        </Authorized>
    </AuthorizeView>
    <MudDivider Class="my-2"/>
    <AuthorizeView>
        <Authorized>
            <MudNavLink Href="/myProfile" Icon="@Icons.Filled.Person" IconColor="Color.Primary">@(context.User.Identity.Name)'s Profil</MudNavLink>
            <MudNavLink Href="/logout" Icon="@Icons.Filled.Logout" IconColor="Color.Primary">Logout</MudNavLink>
        </Authorized>
        <NotAuthorized>
            <MudNavLink Href="/login" Icon="@Icons.Filled.Login" IconColor="Color.Primary">Login</MudNavLink>
            <MudNavLink Href="/register" Icon="@Icons.Filled.PersonAdd" IconColor="Color.Primary">Register</MudNavLink>
        </NotAuthorized>
    </AuthorizeView>
</MudNavMenu>

@code{
    System.Timers.Timer timer = new(2 * 60 * 1000);

    void TimerTick()
    {

    }

    public NavMenu()
    {
        timer.Elapsed += RefreshToken;
        timer.Start();
    }

    void RefreshToken(object sender, ElapsedEventArgs e)
    {
        http.PostAsync("api/auth/refreshtoken", new StringContent(""));
    }
}